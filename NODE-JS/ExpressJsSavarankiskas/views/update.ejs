<%- include('../partials/head.ejs') %> <%- include('../partials/nav.ejs') %>

<div class="create-book content">
  <p>Editing book: <%= book.title %></p>
  <form id="editBookForm">
    <label for="title">Book name</label>
    <input type="text" id="title" name="title" required />
    <label for="author">Author</label>
    <input type="text" id="author" name="author" required />
    <label for="year">Year</label>
    <input type="number" id="year" name="year" required />
    <label for="description">Description</label>
    <textarea id="description" name="description" required></textarea>
    <a class="edit" data-id="<%= book._id %>"> Edit book </a>
  </form>
</div>

<script>
  const edit = document.querySelector("a.edit");
  const form = document.getElementById("editBookForm");
  const endpoint = `/books/update/${edit.dataset.id}`;
  edit.addEventListener("click", (e) => {
    e.preventDefault();
    console.log(endpoint);

    const formData = {
      title: form.title.value,
      author: form.author.value,
      year: Number(form.year.value),
      description: form.description.value.trim(),
    };
    console.log(formData);
    fetch(endpoint, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(formData),
    })
      .then((response) => response.json())
      .then((data) => {
        console.log("gaute:", data);
        window.location.href = "/books";
      })
      .catch((err) => console.log(err));
  });
</script>

<%- include('../partials/footer.ejs') %>
